# Контекст проекта: Лифт со слогами

Обучающая игра для детей ~5 лет. Лифт с согласной буквой ездит по этажам с гласными, формируя слоги. Ребёнок нажимает стрелки, лифт едет, на каждом этаже показывается слог + слово-подсказка с иконкой.

**Демо:** https://ivanalekseevichpopov.github.io/elevatorGame/

## Стек и ограничения

- **Vanilla JS/HTML/CSS** — без фреймворков, без сборки, без npm
- Один HTML-файл подключает `syllables-words.js`, затем `game.js` через `<script>`
- Иконки — SVG-файлы из Lucide в папке `icons/`
- Внешняя зависимость — только Font Awesome 6.4.0 (CDN) для иконок интерфейса (флажки, стрелки, кнопки)
- Звук победы — Web Audio API (синтез, без файлов)
- Озвучка слогов — WAV-файлы в `sounds/`, сгенерированы Silero TTS
- **Мобильные устройства (<600px) заблокированы** — показывается заглушка `#mobileBlock`

## Структура файлов

```
index.html           — 3 экрана: выбор буквы, игра, победа + заглушка для мобильных
styles.css           — стили, анимации, адаптив, CSS-переменные для тем
game.js              — вся логика: состояние, DOM, движение лифта, победа, озвучка
syllables-words.js   — данные: слог → {слово, иконка} для каждой согласной
icons/*.svg          — ~70 SVG-иконок из Lucide
sounds/aidar/*.wav   — озвучка слогов (голос aidar, slow) — 100 файлов
sounds/eugene/*.wav  — озвучка слогов (голос eugene, x-slow) — 100 файлов
```

## Архитектура

### Состояние игры (глобальные переменные в game.js)

```js
let selectedConsonant = '';      // Выбранная согласная (М, Н, П, ...)
let currentFloor = 0;            // Текущий этаж (0–10, где 10 = крыша/победа)
let isMoving = false;            // Блокировка во время анимации (0.4с)
let collectedSyllables = [];     // Собранные слоги для экрана победы
let currentVoice = 'aidar';      // Текущий голос озвучки ('aidar' | 'eugene')
let syllableAudio = null;        // Текущий воспроизводимый Audio объект
```

### Константы

```js
const vowels = ['А', 'О', 'У', 'И', 'Е', 'Ы', 'Ю', 'Э', 'Я', 'Ё'];  // 10 гласных = 10 этажей
const consonants = ['М', 'Н', 'П', 'Б', 'К', 'Т', 'Д', 'С', 'Л', 'Р']; // 10 согласных для выбора
```

### Поток игры

```
[Экран выбора] → selectConsonant(letter) → [Экран игры] → moveUp()/moveDown()
    ↑                                                          ↓
    └──── goToSelection() ← [Экран победы] ← showVictory() ←──┘ (currentFloor === 10)
                              playAgain() → сброс на этаж 0
```

### Ключевые функции (game.js)

| Функция | Назначение |
|---------|-----------|
| `initSelectionScreen()` | Создаёт кнопки выбора согласных с индивидуальными цветами |
| `selectConsonant(letter)` | Запускает игру: применяет тему, строит здание |
| `applyColorScheme(letter)` | Устанавливает CSS-переменные `--color-*` и `--icon-filter` |
| `initBuilding()` | Создаёт DOM: 10 этажей + крыша + лифт + окна/балконы/дверь |
| `moveUp()` / `moveDown()` | Двигают лифт. Блокировка 0.4с через `isMoving`. Победа при `currentFloor === vowels.length` |
| `updateSyllableDisplay()` | Обновляет слог + подсказку (слово + иконка из `syllablesData`), вызывает `speakSyllable()` |
| `updateElevatorPosition()` | Позиционирует лифт: `bottom = currentFloor * 55 + 6` пикселей |
| `speakSyllable(consonant, vowel)` | Воспроизводит аудиофайл слога из `sounds/{currentVoice}/` |
| `setVoice(voice)` | Переключает голос озвучки (`'aidar'` или `'eugene'`) |
| `showVictory()` | Показывает оверлей, запускает звук и конфетти |

## Система тем (CSS-переменные)

Каждая согласная имеет цветовую схему в объекте `colorSchemes`. При выборе буквы `applyColorScheme()` устанавливает на `:root`:

```
--color-dark       — тёмный оттенок (лифт, текст слога)
--color-primary    — основной цвет (гласные, кнопки победы)
--color-light      — светлый (шахта лифта, кнопки управления)
--color-lighter    — самый светлый (градиенты, тени)
--color-shadow     — тень на основе dark
--color-shadow-light — тень на основе lighter
--icon-filter      — CSS filter для окрашивания чёрных SVG-иконок в цвет темы
```

Цвета букв: М=изумрудный, Н=синий, П=фиолетовый, Б=индиго, К=коралловый, Т=оранжевый, Д=золотистый, С=бирюзовый, Л=лавандовый, Р=мятный.

## Формат данных (syllables-words.js)

```js
const SYLLABLES_DATA = {
  "М": {                              // Согласная
    "А": { "word": "машина", "icon": "car" },  // Слог МА → слово + имя файла иконки (без .svg)
    "О": { "word": "морковь", "icon": "carrot" },
    "Ю": null,                        // null = нет подсказки для этого слога
    ...
  },
  ...
};
```

**Правила:**
- `icon` — имя файла без расширения из `icons/` (например, `"car"` → `icons/car.svg`)
- `null` — слог существует, но подсказка не готова (иконка не показывается)
- Слово должно **начинаться с этого слога** (МА-шина, МО-рковь, МУ-ха)
- Слово должно быть понятно ребёнку 5 лет

### Текущий статус заполнения

| Буква | Статус | Заполнено |
|-------|--------|-----------|
| М | Готово | 8/10 (нет МЮ, МЭ) |
| Н | Частично | 3/10 |
| П | Готово | 7/10 |
| Б–Р | Заглушки (null) | В комментариях есть заготовки |

В коде `syllables-words.js` закомментированы заготовки для Б, К, Т, Д, С, Л, Р — слова подобраны, но иконки не проверены.

## Озвучка слогов

Слоги озвучиваются при каждой смене этажа. Аудиофайлы сгенерированы с помощью **Silero TTS v4** (русские голоса).

### Голоса

| Голос | Папка | Скорость SSML | Описание |
|-------|-------|---------------|----------|
| `aidar` | `sounds/aidar/` | `slow` | Мужской голос, умеренно медленный |
| `eugene` | `sounds/eugene/` | `x-slow` | Мужской голос, очень медленный |

По умолчанию используется `aidar`. Переключение: `setVoice('eugene')`.

### Формат имён файлов

Транслитерация кириллицы:
```
М→m, Н→n, П→p, Б→b, К→k, Т→t, Д→d, С→s, Л→l, Р→r
А→a, О→o, У→u, И→i, Е→e, Ы→y, Ю→yu, Э→eh, Я→ya, Ё→yo
```

Примеры: `МА` → `ma.wav`, `КЮ` → `kyu.wav`, `НЯ` → `nya.wav`

### Перегенерация аудио

Скрипт `generate_all.py` генерирует все 100 слогов через Docker:

```bash
docker run --rm \
  -v "$(pwd)/generate_all.py:/app/generate_all.py" \
  -v "$(pwd)/sounds:/output" \
  python:3.11-slim \
  bash -c "pip install -q torch torchaudio --index-url https://download.pytorch.org/whl/cpu && \
           pip install -q omegaconf scipy numpy && python /app/generate_all.py"
```

## DOM-структура (index.html)

Три экрана переключаются CSS-классами (`hidden`, `active`):

```
body
├── #mobileBlock         — заглушка для экранов < 600px
├── #selectionScreen     — выбор согласной (grid из кнопок)
│   ├── #consonantsGrid  — генерируется в initSelectionScreen()
│   └── .parent-tips     — советы родителям
├── #gameScreen          — игровой экран
│   ├── .building-wrapper
│   │   ├── .roof        — треугольная крыша с трубой
│   │   └── #building    — генерируется в initBuilding()
│   │       ├── .floor.roof-floor  — 11-й этаж (финиш с флагом)
│   │       ├── .floor (×10)       — этажи с гласными, окнами/балконами/дверью
│   │       └── #elevatorWrapper   — абсолютно позиционированный лифт
│   ├── .syllable-panel
│   │   ├── #syllableDisplay — большой текст слога (64px)
│   │   └── #wordHint       — иконка + слово
│   └── .controls            — кнопки ▲ ▼ и выход
└── #victoryOverlay          — экран победы с собранными слогами
```

## Здание (детали DOM)

- **10 этажей** сверху вниз: Ё(10), Я(9), Э(8), Ю(7), Ы(6), Е(5), И(4), У(3), О(2), А(1)
- **11-й этаж** = крыша (финиш с флагом Font Awesome)
- Высота этажа: **55px** (используется для расчёта позиции лифта)
- **Этаж 1** (А) — входная дверь
- **Этажи 2, 5, 8** (i % 3 === 1) — балконы
- Остальные этажи — обычные окна

## Анимации

- `pop` (0.4s) — пульсация слога при смене этажа
- `bounce` (0.6s infinite) — прыгающий текст победы
- `popIn` (0.5s backwards) — появление бейджей слогов на экране победы
- `fadeIn` (0.5s) — появление оверлея победы
- Лифт — CSS transition `bottom 0.4s ease-in-out`
- Конфетти — Web Animations API, 50 частиц, 2-4с падение

## Правила для изменений

1. **Добавлять зависимости только с разрешения пользователя** — проект должен работать без npm/сборки, открытием index.html
2. **Все тексты на русском** — целевая аудитория русскоязычная
3. **SVG-иконки** должны быть одноцветными (чёрными) — они окрашиваются через CSS filter (`--icon-filter`)
4. **Не ломать мобильную заглушку** — экраны < 600px должны показывать только `#mobileBlock`
5. **Слова для слогов** должны начинаться с этого слога и быть понятны ребёнку 5 лет
6. **Новые иконки** добавлять в `icons/` как SVG из Lucide (https://lucide.dev) или других ресурсов(похожие по стилю Lucide)
7. **Высота этажа 55px** жёстко зашита в CSS (.floor height) и JS (updateElevatorPosition). Менять синхронно
8. **Аудиофайлы слогов** — WAV в `sounds/{voice}/`, имена по транслитерации (см. `TRANSLIT` в game.js)
